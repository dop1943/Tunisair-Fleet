---
title: "Lab1 Flotte Tunisair"
author: "Groupe1-4DS2"
date: "15 octobre 2018"
output:
  html_document: default
  word_document: default
---

#COMPREHENSION METIER:

##Background de la situation de l'enreprise
Tunisair est la compagnie aérienne nationale de la Tunisie , fondée en 1948 , anciennement appelée «Société Tunisienne de l'air» . Aujourd'hui son réseau s'étend sur 48 destinations à travers le monde .
Depuis la révolution de 2011 et suite à la menace terroriste qui régnai sur la Tunisie , Tunisair s'est vue passer par de grandes difficultés financières due à une baisse importante du nombre de voyageurs ainsi qu'à cause de scandales au sein de l'entreprise .
Evènements marquants post-révolution :
En janvier 2017  , la compagnie annonce une croissance de 8,6% par rapport à 2016 (nombre de passager passe de 221-452 à 240-555 , quoi que le taux de remplissage diminue passant de 71.3% à 70.4% .
Ouverture de nouvelle lignes vers Constantine (Algérie) et Conakry (Guinée) 
En août 2017, la direction annonce que le trafic passagers a connu un accroissement de 22,7% en juillet par rapport à la même période en 2016
Ouverture d'une nouvelle ligne vers Cotonou, la capitale économique du Bénin
Inauguration d'une nouvelle application mobile pour une réservation plus facile des vols.
11 Decembre 2017: Nouvel accord de l'ouverture du ciel Tunisien avec l'union européenne . Ce qui a obligé Tunisair à annoncer l'ouverture en 2018 d'un vol vers New York mais également, d'ici fin 2020, vers Khartoum, Douala, N'Djaména, Accra,Lagos et Libreville et une modernisation de sa flotte d'avion .
Janvier 2018: Augmentation du trafic de 17.1% , de (2 991 841 à 3 502 475 passagers) , hausse des recettes , de 995,1 millions de dinars à 1,28 milliard de dinars . et une baisse du niveau des retards (de 55% à 44%)
On constate donc que Tunisair est en train d'adopter une nouvelle stratégie pour face à la concurrence en ouvrant de nouvelles lignes vers des villes de l'Afrique et de l'Amérique
Sa flotte actuelle lui permet-elle d'assurer des vols vers ces nouvelles destinations ?

##Informations relatives aux objectifs Métier :
###Flotte de Tunisair:
La moyenne d'âge des avions de Tunisair est de 15 ans .
Actuellement elle possède une flotte opérationnelle de 29 appareils en exploitation, dont 22 Airbus et 7 Boeing. En regardant ces appareils de plus près, on peut constater que ces différents appareils ont été acquis entre 1999 et 2015 . A noter également qu'aucun avion n'a été acheté avant la période entre 2015.
Ce qui nous amène à nous questionner sur la qualité matérielle des appareils les plus âgés.
Sécurité:
Tunisair est classée selon l'observatoire aérien et du tourisme parmi les compagnies les plus sures du monde devançant ainsi toutes les autres compagnies africaines.
Concurrence:
Beaucoup ont vu d'un oil pessimiste la signature de l'accord de l'Open Sky  prétextant que cette compagnie n'était pas encore prête. Pourtant qui dit Open Sky dit plus de voyageurs et plus de parts de marché à acquérir.
Quels sont les raisons de ce pessimisme?
Quels sont les principaux concurrents actuels de Tunisair?
Existent-t-ils des normes qui pourrait entrer en jeux dans la concurrence que l'Open Sky a à offrir?
Selon le site d'info Kapitalys «la Tunisie n'est jamais arrivée à exploiter plus de 35% des parts de marché qui lui revenait de droit , et ce en raison de moyens logistiques et financiers très faibles .
Selon la même source, le taux de remplissage des sièges est de 70% , ce qui met Tunisair plus en difficulté vu que qu'elle va devoir faire face à des concurrents plus puissants financièrement et mieux équipés qui pourront très facilement imposer leur prix. 
Pourtant des succès stories relatives à l'Open Sky ont bel se sont bel et bien  produites, on peut citer par exemple: «Royal Air Maroc» , «Turkish Airlines» et bien d'autres .
C'est tout simplement parce qu'une plus grande concurrence incite les compagnies à baisser fortement les prix, ce qui a pour conséquence immédiate et mécanique de faire augmenter la demande.
La concurrence oblige les uns et les autres à soigner de manière plus rigoureuse leur qualité de service et le confort des passagers, s'ils veulent préserver leurs parts de marchés.
Les principaux concurrents régionaux de Tunisair sont principalement issus du Maroc, d'Algérie, de l'Egypte. On peut également citer Syphax et Nouvelair qui sont des compagnies locale.
Pour ce qui est des concurrents internationaux , ces concurrents nous viennent principalement des pays du golfe , de l'Asie , d'Europe et d'Afrique .

En nous intéressant à ces différentes compagnies Low-Cost, on  peut déjà remarquer que l'atout majeure de ces compagnies est un nombre important d'avions , toujours plus confortables et à la pointe de la technologie qui consomment de moins en moins de carburant  . Par exemple rien qu'en 2013 Turkish Airlines a commandé 117 Airbus et 95 Boeing (d'après la tribune.fr) 
On pourrait également nous tourner vers des sites et applications de voyage tel que Trip-Advisor ou encore Flight-report et essayer de récolter données d'avis d'utilisateurs sur TunisAir pour savoir si elle répond aux exigences des voyageurs .
Comme mentionné tout à l'heure, Tunis Air souffre de nos jours d'un grand problème de retards répétitifs. En essayant de chercher la cause de ses retards, on constate que dans la majeure partie des cas, cela est dû à des problèmes techniques. Cela nous ramène à nous questionner encore une fois sur la qualité des avions qu'elle compte au sein de sa flotte. Sachant que le temps pour les voyageurs est d'une importance capitale, nous devrions peut-être essayer de collecter des données pour savoir TunisAir arrive encore à répondre aux exigences de ses clients en terme de temps.
Enfin, dans cette même optique , peut être devrions nous collecter des données sur des destinations desservies par TunisAir , et essayer de comparer la durée du trajet avec d'autre compagnies pour pouvoir conclure convenablement .
##Data science goals 

Pour trouver des solutions stratégiques à Tunisair , Nous allons essayer de comprendre sur quoi se basent les utilisateurs en attribuant une note à une compagnie. Pour ce faire nous ferons appel à la technique d'apprentissage automatique appelée foret d arbre decisionnels .

##Compréhension des données
Lors de la phase de la compréhension des données, nous nous intéressons aux données mises à notre disposition et à leur lien avec notre problématique.
Notre jeu de données est un jeu de données qui porte sur les avions avec leurs compagnies aériennes.
Les fichiers Long_haul_Economy.csv , Short_haul_Economy.csv et Short_haul_First_Business nous renseigne sur les équipements q'on peut trouver dans les avions classés par classe et par type de vol.
Pour ce qui est du fichier aireline-safety.csv , il renseigne sur les accidents et les fatalités qui se sont produits lors des dernières années chez plusieurs compagnies aériennes de renommé.
Pour étudier les retards des avions du à des problèmes technique, on a pu scrappé les commentaires des utilisateurs sur Tunisair du site [airlinequality] (https://www.airlinequality.com/airline-reviews/tunisair/) dans un fichier "testcloud.txt" à partir du code python du fichier ReviewsScrapingAirTrax.ipynb . 
Nous avons également eu besoin d'un data set que nous avons obtenu en scrappant les avis d'utilisateurs à partir du site "AIRTRAX" , qui est une pointure dans la récolte des avis des utilisateurs sur les compagnies aeriennes . Ce dataset contient une des notes attribuées par les voyageurs dans plusieurs domaines , telque le rapport qualité prix , l confort des sieges , la nourriture, etc.
Pour dégager le profil typique d'avion dans le monde, on a utilisé le dataset "FAA Aircraft Characteristics.csv" contenant les avions déclarés par l'FAA.

```{r}
library(xlsx)
reviews=read.xlsx("ReviewsScrapingAirTrax1.xlsx",sheetName = "Feuil1")
str(reviews)
colnames(reviews)
summary(reviews)
dim(reviews)
```
Nous avons donc 9233 lignes et 16 colonnes .
En jettant un coup d'oeil aux résumé nous nous apercevons qu'il y a beaucoup de valeurs NA , nous devrons donc tester plusieurs approches pour faire face à ce probleme

Dans la partie Flotte age , dimension et valeur, nous avons besoin de visualiser les données afin de les comprendre: une bonne analyse nous permettons
de déterminer les grands points et aiser la phase de la preparation des données pour ce là on va utiliser tableau
![](C:/Users/Njeimi Amal/Desktop/4eme/ML/lab1/Captur44.PNG)
![](C:/Users/Njeimi Amal/Desktop/4eme/ML/lab1/Capture.PNG)
![](C:/Users/Njeimi Amal/Desktop/4eme/ML/lab1/Capaature.PNG)
![](C:/Users/Njeimi Amal/Desktop/4eme/ML/lab1/Capture100.PNG)
 
#Préparation des données:
Comme mentionné précedemment on a des fichiers csv des équipements des avions par compagnie aérienne, par le type du vol et le type du classe donc on a tiré seleument les  équipements dont on souhaite analyser et qui sont le type Video, Laptop Power,Power Type,Wi-Fi et le type du siège. 
Afin de mieux analyser les accidents recourus j'ai joué que sur ceux qui se sont produits entre les années 2000 et 2014.
Le dataset contient beaucoup de données manquantes (des champs "tbd", "No Value", "#VALUE!", etc.)
On a remplacé tout ces valeurs par la valeur moyenne en cas des valeurs réelles et la médiane en cas des valeurs entières.
Mais cette correction a été rejetée car les données deviennent biaisées.
On a éliminé les valeurs qualitatives pour appliquer les algorithmes de segmentation.


```{r chargement Short-haul Economy Class}
library(arules)
Short_haul_economy_Classtotal = read.csv("Short_haul_Economy.csv",sep=";")
f3=Short_haul_economy_Classtotal[which(Short_haul_economy_Classtotal$Airline=="Tunis Air"),]
Short_haul_economyTunisair=f3[,c(5:9)]
write.table(Short_haul_economyTunisair, "Short_haul_Economy_ClassTunisair.csv", sep=",",quote = FALSE,row.names = FALSE)
Short_haul_economyecrire = Short_haul_economy_Classtotal[,c(5:9)]
write.table(Short_haul_economyecrire, "Short_haul_Economy_Class2.csv", sep=",",quote = FALSE,row.names = FALSE)
Short_haul_Economy_Class = read.transactions("Short_haul_Economy_Class2.csv",sep=";",skip = 1)
Short_haul_Economy_Classtunisair = read.transactions("Short_haul_Economy_ClassTunisair.csv",sep=";",skip = 1)
```
```{r chargement Short-haul  First/Business}
Short_haul_First_Classtotal = read.csv("Short_haul_First_Business.csv",sep=";")
f=Short_haul_First_Classtotal[which(Short_haul_First_Classtotal$Airline=="Tunis Air"),]
Short_haul_First_BusinessTunisair=f[,c(5:9)]
write.table(Short_haul_First_BusinessTunisair, "Short_haul_First_BusinessTunisair.csv", sep=",",quote = FALSE,row.names = FALSE)
Short_haul_First_Businessecrire = Short_haul_First_Classtotal[,c(5:9)]
write.table(Short_haul_First_Businessecrire, "Short_haul_First_Business2.csv", sep=",",quote = FALSE,row.names = FALSE)
Short_haul_First_Class = read.transactions("Short_haul_First_Business2.csv",sep=";",skip = 1)
Short_haul_First_ClassTunisair = read.transactions("Short_haul_First_BusinessTunisair.csv",sep=";",skip = 1)
```
```{r chargement Short-haul  s}
long_haul_economyTotal = read.csv("Long_haul_Economy.csv",sep=";")
f2=long_haul_economyTotal[which(long_haul_economyTotal$Airline=="Tunis Air"),]
long_haul_economyTunisair=f2[,c(5:9)]
write.table(long_haul_economyTunisair, "long_haul_economyTunisair.csv", sep=",",quote = FALSE,row.names = FALSE)
long_haul_economyTunisairecrire = long_haul_economyTotal[,c(5:9)]
write.table(long_haul_economyTunisairecrire, "long_haul_economy2.csv", sep=",",quote = FALSE,row.names = FALSE)
long_haul_economy = read.transactions("long_haul_economy2.csv",sep=";",skip = 1)
long_haul_economy_ClassTunisair = read.transactions("long_haul_economyTunisair.csv",sep=";",skip = 1)
```

Dans la partie Flotte age , dimension et valeur nous avons utilisé tableau pour l'agrégation et le groupement des données et R pour le netoyage.
```{r}
library(xlsx)

data = read.csv("FAA Aircraft Characteristics.csv",header=T,sep=",",dec=".",na.string="")
summary(data)

  db=read.table("Fleet Data.csv",header = TRUE,sep = ",",na.strings = "")
  db$Unit.Cost=as.numeric(sub("\\$","",db$Unit.Cost))
  db$Total.Cost..Current.=as.numeric(sub("\\$","",sub(",","",db$Total.Cost..Current.)))
  db[is.na(db)]<- 0
  write.xlsx(db,"finalcleaneddata.xlsx")
  
  db5=read.table("c3data.csv",header = TRUE,sep = ";",na.strings = "",dec = ",")
    db5$Moy..Total.Cost..Current.=as.numeric(sub(",",".",sub(" ","",db5$Moy..Total.Cost..Current.)))
```
```{r wx}
data[data == "tbd" | data=="#VALUE!" | data=="No Value"] = NA
data1=data[,c(5,9,11,12,17,18)]
summary(data1)
str(data1)
data1[data1 == "tbd" | data1=="#VALUE!" | data1=="No Value"] = NA
data1$X..Engines =as.numeric(data1$X..Engines)
data1[data1 == "tbd" | data1=="same as 680F" | data1=="same WS as PA-28-235"] = NA
data1$Wingspan..ft =as.numeric(data1$Wingspan..ft)
data1[data1 == "tbd" | data1=="stretched 680F"] = NA
data1$Length..ft =as.numeric(data1$Length..ft)
data1$MTOW =as.numeric(data1$MTOW)
data1$Max.Ramp.Max.Taxi =as.numeric(data1$Max.Ramp.Max.Taxi)
data1=na.omit(data1)
```
Par la suite nous créons le dataframe reviews.forest qui contiendra les principales variables qui peuvent influencer le choix de la note attribuées par les utilisateurs
```{r}
reviews$overall=as.factor(reviews$overall)
reviews$seat_comfort=as.factor(reviews$seat_comfort)
reviews$cabin_service=as.factor(reviews$cabin_service)
reviews$food_bev=as.factor(reviews$food_bev)
reviews$entertainment=as.factor(reviews$entertainment)
reviews$ground_service=as.factor(reviews$ground_service)
reviews$value_for_money=as.factor(reviews$value_for_money)
reviews$recommended=as.factor(reviews$recommended)
```
```{r}
reviews.forest=reviews
reviews.forest$author=NULL
reviews.forest$review_date=NULL
reviews.forest$aircraft=NULL
reviews.forest$route=NULL
reviews.forest$date_flown=NULL
reviews.forest$recommended=NULL
reviews.forest$airline=NULL
colnames(reviews.forest)
```

#MODELISATION et Evaluation:


## ANALYSE DES EXIGENCES DE CONFORT :


###Short-haul Economy Class


```{r associativiteALL}

rules = apriori(Short_haul_Economy_Class, parameter=list(support=0.0001, confidence=0.00001));
inspect(rules)
```
```{r associativiteTunisair}
rulesTunisair = apriori(Short_haul_Economy_Classtunisair, parameter=list(support=0.1, confidence=0.1));
inspect(rulesTunisair)
```
D'après les régles d'association de tous les compagnies aériennes des courts vols economique, on contate que la règle la plus récurante est {None,None,None,No,Standard}: la première valeur correspond à la variable Video Type , la deuxième au Laptop Power , la troixème au Power Type , la quatrième au Wi-Fi et la dernière au Seat Type. Cette règle est suivie par 338 compagnies. Et on constate aussi que Tunisair suit cette règle.
Mais on voit que cette règle ne répond pas aux exigences.


###Short-haul First/Business

```{r associativiteALLF}
rulesfirst = apriori(Short_haul_First_Class, parameter=list(support=0.001, confidence=0.001));
inspect(rulesfirst)
```

```{r associativiteALLTunisairF}
rulesfirsttunisair = apriori(Short_haul_First_ClassTunisair, parameter=list(support=0.01, confidence=0.01));
inspect(rulesfirsttunisair)
```
D'après les régles d'association de tous les compagnies aériennes qui ont des courts vols First/Business, on contate que la règle la plus récurante est {Overhead TV,None,None,No,Recliner}. Cette règle est suivie par 43 compagnies. La deuxième régle la plus récurrente est {None,None,None,No,Standard}.Elle est suivis par 41 compagnies.La troixième est {None,None,None,No,Recliner}, suivie par 32 compagnies. On constate que Tunisair suit la deuxième et la troixième.
Mais on voit aussi que ces règles ne répondent pas aux exigences.

###Long-haul Economy


```{r associativiteALLTunisairE}
ruleseconomylongtunisair = apriori(long_haul_economy_ClassTunisair, parameter=list(support=0.01, confidence=0.01));
inspect(ruleseconomylongtunisair)
```

```{r associativiteALLEL}
ruleseconomylong = apriori(long_haul_economy, parameter=list(support=0.0001, confidence=0.00001));
inspect(ruleseconomylong)
```
D'après les régles d'association de tous les compagnies aériennes qui ont des lonfs vols economique, on contate que la règle la plus récurante est On-Demand TV,All Seats,AC Power,Yes,Standard}. Cette règle est suivie par 119 compagnies.Par contre Tunisair ne suit pas une règle très récurente {Seatback TV,None,None,No,Standard}.Elle est suivie par 34 compagnies.
Mais on voit aussi que ces règles ne répondent pas aux exigences.


##ANALYSE DES EXIGENCES DE SECURITE AERIENNE :


On va étudier la securité des airlines , précisemment pour les
15 dernières années . Pour ce qui est de la Tunisair,la compagnie tunisienne  est classée selon l'observatoire aérien et du tourisme, parmi les compagnies les plus sures du monde devançant ainsi toutes les autres compagnies africaines , enregistrant presque aucun incident pour les 3 dernières années 


```{r Importation des données}
dataset = read.csv("airline-safety.csv",sep=",",na.strings = "")
dataset
summary(dataset)
```

### Segmentation avec K-means
Dans ce qui suit je vais caractériser les airlines selon le critère se sureté afin de préciser l'ensmble où Tunisiar est relative.
```{r k-means clustering}
wss <- (nrow(data.matrix(dataset)-1)*sum(apply(data.matrix(dataset),2,var)))
for (i in 2:15) wss[i] <- sum(kmeans(data.matrix(dataset), 
                                     centers=i)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")
# K-Means Cluster Analysis
fit <- kmeans(data.matrix(dataset), 5) # 5 cluster solution
# get cluster means 
aggregate(data.matrix(dataset),by=list(fit$cluster),FUN=mean)
#Jouer sur les années entre 2000 et 2014
data00_14=dataset[,c(1,6,7,8)]
# append cluster assignment
mydata <- data.frame(data.matrix(data00_14), fit$cluster)
mydata
```

On remarque pour ce qui est des airlines appartenant au cluster 4 , un taux de securité elevé incluant une compagnie avec 0 accidents et fatalités.

### Visualisation des accidents par airline entre 2000 et 2014

```{r part3}
library(ggplot2)
ggplot(dataset, aes(dataset$incidents_00_14,dataset$airline , color = fit$cluster)) + geom_point()
```

Dans le secteur de la securité aerienne on constate que suite aux performances impécables de la tunisair du coté de la sureté de ses vols ayant enregisré qu'un seul crash , elle apartient sans aucun doute 4éme segent d'airlines.
On peut conclure après cette analyse que Tunisiar peut répondre à la concurrence imposé dans ce secteur.

##Analyse de l'exigence Retards :
```{r temps}

library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")

source('http://www.sthda.com/upload/rquery_wordcloud.r')
filePath <- "testcloud.txt"
res<-rquery.wordcloud(filePath, type ="file", lang = "english",excludeWords = c("flight","tunisair","tunis"))
head(res$freqTable,20)

```
Le mot "delayed"-> "retard" apparait 33 fois dans les avis des utilisateurs scrappés. On peut constater que les voyageurs ont souffert des retards qui sont dues la plupart du temps à des problèmes techniques. Donc la flotte de TunisAir ne répond pas à l'exigence temps.

##Analyse des avis
```{r i}
set.seed(123)
library(randomForest)
forest=randomForest(reviews.forest$overall~.,data = reviews.forest,na.action = na.omit)
```
Ici nous fixons la graine du générateur aléatoire .
Nous lançons aprés randomForest qui est une methode d'apprentissage automatique supervisée .
Nous laissons les paramétres par défauts pour les nombre d'arbres et de variables par arbre .
Nous choisissons également dans un premier temps de ne pas prendre en compte les valeurs NA.
```{r u}
print(forest)
```
Le nombre d'arbres aléatoire généré est 500 et le nombre de variables par arbre est de 2.
Avec ce paramétrage nous avons obtenu un taux d'erreur de 52.7%
Nous remarquons également que notre modele a su reconnaitre les compagnies ayant obtenues 1/10 avec 0.18% d'erreur .

```{r t}
varImpPlot(forest)
```
Ce graphique nous montre les principales variables entrant en jeu dans la note attribuées aux copagnies .
Nous déduisons donc que les utilisateurs se basent principalement  sur : le rapport qualité prix , le service au sol et l'équipage de l'avion ainsi que le confort du siege .


```{r v1}
forest1=randomForest(reviews.forest$overall~.,data = reviews.forest,na.action = na.roughfix)
print(forest1)
```
En affectant la valeur mediane aux valeur NA , nous n'avons pas pu amélioré le OOB qui a augmenté de 0.37%.
```{r n1}
forest2=randomForest(reviews.forest$overall~.,data=reviews.forest,na.action=na.omit,ntree = 5000)
print(forest2)
```
En augmentant le nombre d'arbres , nous avons pu ameliorer le OOB qui a legerement diminué .
```{r m}
plot(forest2$err.rate[,1],type='l',xlab="Nombre d'arbre",ylab="Taux d'erreurs")
```
Nous remarquons donc que le taux d'erreurs se stabilise à partir de 1200 , nous prendrons donc cette valeur.
```{r z}
res=c()
res[1]=forest2$err.rate[1200]
for (i in 3:10){
  forest2=randomForest(reviews.forest$overall~.,data=reviews.forest,mtry=i,ntree=1200,na.action = na.omit)
  res[i-1]=forest2$err.rate[1200]
}
plot(res)
```
Ceci montre que le meilleur nombre de variable par arbre est de 2 .
```{r w}
forest2=randomForest(reviews.forest$overall~.,data=reviews.forest,mtry=2,ntree=1200,na.action = na.omit)
forest$importance[order(forest$importance,decreasing = T),]
```
Finalement nous trouvons que pour noter une compagnie les utilisaeurs se basent en premier lieu , sur le rapport qualité prix , puis sur le service au sol , le service cabine et la nourriture .


PARTIE 2 :
Dans cette partie nous nous interessons plutot à la colonne recommend .
Sur se basent les voyageurs pour recommender une compagnie aerienne ?
```{r p}
reviews.forest1=reviews.forest
reviews.forest1$overall=NULL
reviews.forest1$recommend=reviews$recommended
forest3=randomForest(reviews.forest1$recommend~.,data=reviews.forest1,na.action = na.roughfix)
print(forest3)
```
Dans ce cas là on obtient de meilleurs resultats , vu que Recommend n'a que deux modalités .
le taux d'erreurs est de 9.25% ce qui est formidable .
500 arbres ont été généré et 2 variables ont été prises pour chaque arbre 
```{r n}
forest3$importance[order(forest3$importance[,1],decreasing =T),]
```
Comme dans la premiere partie , les utilisateurs se basent le plus sur le rapport qualité prix pour recommender une compagnie . Cependant , en deuxieme position nous trouvons le service des cabines(4éme dans l'autre partie) , le confort du siege(3éme dans partie 1) , le service au sol(2éme dans l'autre partie) etc ..
```{r}
forest3=randomForest(reviews.forest1$recommend~.,data=reviews.forest1,na.action=na.omit)
print(forest3)
```
En décidant d'omettre les NA , le taux d'erreurs diminue de 0.9% environ
```{r l}
forest3=randomForest(reviews.forest1$recommend~.,data=reviews.forest1,na.action=na.omit,ntree=5000)
print(forest3)
```
En choisissant de travailler avec 5000 arbre nous réduisons le taux d'erreur de 0.16%
```{r j}
plot(forest3$err.rate[,1],xlab="nombre d'arbre ",ylab="taux d erreurs")
```
Nous décidons donc de prendre 1500 comme nombre d arbres 
```{r h}
forest3=randomForest(reviews.forest1$recommend~.,data=reviews.forest1,na.action=na.omit,ntree=1500)
print(forest3)
```
```{r x}
res=c()
res[1]=forest3$err.rate[1500]
for (i in 3:8){
  forest3=randomForest(reviews.forest1$recommend~.,data=reviews.forest1,mtry=i,ntree=1500,na.action = na.omit)
  res[i-1]=forest3$err.rate[1500]
}
plot(res)
```
Il est clair que 2 variable par arbre nous donne de meilleurs resultats
```{r v}
forest3=randomForest(reviews.forest1$recommend~.,data=reviews.forest1,mtry=2,ntree=1500,na.action = na.omit)
forest3$importance[order(forest3$importance[,1],decreasing =T),]
```
Comme dans la premiere partie , les utilisateurs se basent le plus sur le rapport qualité prix pour recommender une compagnie , puis le service cabine , le service au sol et le confort du siege.
```{r s}
varImpPlot(forest3)
```
Partie 3:
```{r aviiiiiiiis}
aux = levels(reviews$airline)
par(mfrow=c(2,2))
for (i in aux){
  if(i!="http://www.airlinequality.com/airline-reviews/delta-air-lines/"){
  a=reviews[reviews$airline==i,]
  tab=table(a$seat_comfort)
  tot=sum(tab)
  barplot(tab/tot*100,xlab="Seat Comfort Rating",ylab = "Percent of reviews",main = a$airline[1])}
}

aux=aux = levels(reviews$airline)
par(mfrow=c(2,2))
for (i in aux ){
  if(i!="http://www.airlinequality.com/airline-reviews/delta-air-lines/"){
  a=reviews[reviews$airline==i,]
  tab=table(a$food_bev)
  tot=sum(tab)
  barplot(tab/tot*100,xlab="Food Rating",ylab = "Percent of reviews",main = a$airline[1])}
}
aux = levels(reviews$airline)
par(mfrow=c(2,2))
for (i in aux){
  if(i!="http://www.airlinequality.com/airline-reviews/delta-air-lines/"){
  a=reviews[reviews$airline==i,]
  tab=table(a$value_for_money)
  tot=sum(tab)
  barplot(tab/tot*100,xlab="Value for Money",ylab = "Percent of reviews",main = a$airline[1])}
}
aux=aux = levels(reviews$airline)
par(mfrow=c(2,2))
for (i in aux){
  if(i!="http://www.airlinequality.com/airline-reviews/delta-air-lines/"){
  a=reviews[reviews$airline==i,]
  tab=table(a$cabin_service)
  tot=sum(tab)
  barplot(tab/tot*100,xlab="Cabine Service Rating",ylab = "Percent of reviews",main = a$airline[1])}
}
aux=aux = levels(reviews$airline)
par(mfrow=c(2,2))
for (i in aux){
  if(i!="http://www.airlinequality.com/airline-reviews/delta-air-lines/"){
  a=reviews[reviews$airline==i,]
  tab=table(a$recommended)
  tot=sum(tab)
  barplot(tab/tot*100,xlab="Recommend ?",ylab = "Percent of reviews",main = a$airline[1],col = c("red","blue"))}
}
```

En inspectant ces visiualisaion nous nous apercevons que Tunisair a un sérieux retard par rapport à ses concurents en matiere de nourriture , de service . Par contre il s'avere qu'elle a un tres bon rapport qualité prix .

##Flotte age , dimension et valeur:

```{r ddd}
 db5
    dbquanti=db5[,-1]
na.fail(dbquanti)
str(dbquanti)
  gpe_kmeans2=kmeans(dbquanti,4)
  
  gpe_kmeans2
library(fpc)
plotcluster(dbquanti, gpe_kmeans2$cluster)
```
On peut conclure que tunisair appartient a un profil qui a une flotte moyennement agées 
avec une petite flotte et des demandes trés faible dans le futur


##Analyse du profil typique des avions


###Application de k-means :

```{r}
k=kmeans(data1,5)
summary(k)
k

```

Application de CAH :

```{r}
d=dist(data1,"euclidean")
hc=hclust(d, method="average")
hc
plot(hc)
rect.hclust(hc, k=5)
```

Nous obtenons deux profils majeurs pour l'avion à l'échelle mondiale.
Nous avons deux clusters de 151 et 150 modèles.
Nous observons deux clusters dominants dans le dendrogram.    

#Déploiment
Pour conclure , nous pouvons assurer que Tunisair pourra augmenter ses parts de marché rien qu'en améliorant ces différents domaines (service , nourriture , confort)
Elle pourra ainsi gagner de l'argent qu'elle pourrait investir dans l'achat de nouveaux avions.
 En effet, il y a des avions qui sont stockés dans des cimetières situés dans le désert californiens et en Arizona, alors Tunisair pourrait en acquérir à raison de 3 appareils pour le prix d'un appareil neuf de même catégorie.
C'est l'une des solutions envisagées pour que Tunisair puisse tirer de juteux bénéfices
